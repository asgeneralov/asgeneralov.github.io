---
title: Управление зависимостями
layout: default
order: 3
---

# {{ page.title}}
Зависимости — это библиотеки, которые необходимы для корректной работы приложения. 
Они указываются в секции dependencies pom-файла. Каждая библиотека может иметь свои зависимости, 
а список всех библиотек проекта, включая их зависимости, называется транзитивными зависимостями.
Представим себе проект со следующей структурой зависимостей.
```
my-app.jar 1.0
  + libA 6.3.21
    + libB 8.10.11
      + libC 1.1.2
  + libX 3.2.1
    + libY 6.9.0
      + libB 9.3.0

```
Тогда транзитивны зависимости проекта это:  
```
libA 6.3.21
lioB 8.10.11
libC 1.1.2
libX 3.2.1
libY 6.9.0
```
Интересно, что библиотека libB упоминается в зависимостях дважды, однако в итоговый список транзитивных зависимостей попала только версия 8.10.11. 
Это произошло из-за правила Maven, согласно которому выбирается ближайшая зависимость к корневому pom-файлу проекта. Таким образом, самый надежный способ указать версию конкретной зависимости — это указать её непосредственно в корневом pom-файле.

## Bill Of Material (BOM) 
В Maven есть возможность вести списки библиотек с конкретными версиями. Это назвывается _Bill Of Material_ или список материалов.
Под такой список создается отдельный Maven проект, а в _packaging_ указывается артефакт _pom_.
```
<project>
    <groupId>bom.group</groupId>
    <artifactId>bom.artifact.id</artifactId>
    <version>1.0</version>
    <packaging>pom</packaging>
    
    <dependencyManagement>
       <dependency>
         <groupId>some.group</groupId>
         <artifactId>libA</artifactId>
         <version>0.7</version>
      </dependency>
      <dependency>
        <groupId>some.group</groupId>
        <artifactId>libB</artifactId>
        <version>3.0</version>
      </dependency>
      ...
    </dependencyManagement>
</project>

```
Для того чтобы использовать список материалов достаточно в проекте в секции _dependencyManagement_ импортировать BOM артефакт.
Для этого используется специальная scope=_import_. Так же нужно указывать type=_pom_, так как артефакт не jar (значение по умолчанию). 


```
<project>
    <dependencyManagement>
        <dependency>
            <groupId>bom.group</groupId>
            <artifactId>bom.artifact.id</artifactId>
            <version>1.0</version>
            <type>pom</type>
            <scope>import</scope>
      </dependency>
      <dependency>
            <groupId>some.group</groupId>
            <artifactId>libB</artifactId>
            <version>3.2</version>
      </dependency>
    </dependencyManagement>

    ...
    <dependencies>
        <!-- Версию не указываем если она есть в секции Dependecy-management  -->
        <dependency>
            <groupId>some.group</groupId>
            <artifactId>libA</artifactId>
        </dependency>
        <!-- Переопределяем версию -->
        <dependency>
            <groupId>some.group</groupId>
            <artifactId>libB</artifactId>
            <version>3.1</version>
      </dependency>
       ...
    </dependencies>
    ...
</project>
```
Как видно из примера, указывать версии библиотек описаных в импортированном BOM не нужно, в этом и весь смысл. Maven возьмет версию из BOM, 
и это относится не только к библиотекам проекта, но и к их транзитивным зависимостям.
Кстати _dependency_management_ может быть описана и в родительском pom и результат будет такой-же. Однако, родительский pom
у проекта может быть только один, а испортировать в секции _dependencyЬanagement_ можно сколько угодно BOM.
Важное отличие от списка зависимостей в родительском pom в секци _dependency_ состоит в том, что зависимости указанные в этой секции 
автоматически становяться зависимостями проекта, а зависимости в BOM не более чем справочник версий, чтобы зависимость появилась в проекте
ее нужно явно определить в секции _dependency_ в файле проекта  или в родительском pom.
Если одна и та же библиотека появялется в файле проекта, в секции dependencManageent_ проекта, импортируется вместе с BOM, прилетает как транзитивная заисимость и т.д.
кака же версия в итоге попадет в проект? Действует всё то же правило ближайшей зависимости: 
1. В BOM была указана версия some.group:libB:3.0 берем её
2. В секции _dependency_management_ проекта указана  some.group:libB:3.2 она затирает предыдущий выбор
3. Непосредственно в файле проекта указана версия some.group:libB:3.1 она затирает предыдущий выбор
Итого в проет попадет some.group:libB:3.1 так как она указана непосредственно в проекте. Кстати, если конкурирующие варианты все 
указаны в секции _dependencyManagement_ ьто берется та что встречается первой.  



В секции _dependency_ есть еще один параметр &mdash; _scope_ &mdash; область видимости:
* compile - транзитивная зависимость для проекта и всех которыке включает его как зависимость
* provided - зависимость существуюет только на этапе копиляции проекта
* test - зависимость сущетвует только в процессе компиляции и выполения unit-тестов
* runtime - зависимость не нужна для компиляции проекта но должна присутствовать в режиме исполнения
* import  - специальная область видимости доступнеая только в секции dependencyManagement см. далее