---
layout: default
title:  "Тезисы с JPoint 2024"
---
# {{ page.title}}

## Как готовить свой код к виртуальным потокам 
Автор Олег Естехин (Yandex Cloud)

Что такое вируальные потоки:
- <a href="https://www.youtube.com/watch?v=7GLVROqgQJY">Alan Bateman — Project loom: Modern scalable concurrency for the Java platform (ENG + RUS SUB)</a>
- <a href="https://www.youtube.com/watch?v=kwS3OeoVCno">Иван Углянский — Thread Wars: проект Loom наносит ответный удар</a>
- <a href="https://www.youtube.com/watch?v=WsCJYQDPrrE">Alan Bateman — The Challenges of Introducing Virtual Threads to the Java Platform </a>
- <a href="https://www.youtube.com/watch?v=6nRS6UiN7X0">Continuations - Under the Covers</a>
- <a href="https://fosdem.org/2024/schedule/event/fosdem-2024-3255-virtual-thread-s-next-steps/">Alan Bateman - Virtual Thread’s Next Steps</a>

```
jcmd "${JAVA_PID?}" VM.info | grep "CPU: total"
CPU: total 12 (initial active 12) (6 cores per cpu, 2 threads per core)

jcmd "${JAVA_PID?}" Thread.print | grep tid | wc-l
3346
```

~ 3000 находятся в ожидании 
3000 потоков * 1MB ~ 3GB на стеки потоков

Mount / Unmount / Pinned

Unmount:
- LockSupport.park()
- Thread.sleep()
- Thread.yield()

Pinned:
- synchronized with sleep
- нативный код на стеке

```
var lock = new AutoCloseableReentrantLock();
try (var _ = lock.obtain()) { ... }

var semaphore = newAutoCloseableSemaphore(42);
try(var_ = semaphore.obtain()) { .. }
```
- Минимизировать использование ThreadLocal
- Максимальный размер пула потоков это неявный ограничитель параллельного доступа к лимитированным ресурсам
- Максимальный размер очереди задач для пула потоков это неявный backpressure для источника задач

## Анализ производительности IO-систем на примере асинхронных HTTP-клиентов
Автор Данил Деминцев (Yandex Crowd)

- Асинхронный клиент не зависимт от latency сервера
- [wrk2 http benchmarking tool](https://github.com/giltene/wrk2)
- Можно изолировать отдельные CPU ядра для веб-сервера при помощи: isolcpus, nginx.conf, taskset
- [jmh java benchmark nano](https://github.com/openjdk/jmh)


